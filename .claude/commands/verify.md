# Verify - Code Validation with Evidence Logging

Run code validation and capture timestamped evidence for governance.

## Purpose

Generate auditable evidence of code quality verification. Each verification run produces:
1. **Verification report** - Human-readable summary with pass/fail status
2. **Raw log** - Complete tool output for audit trail
3. **Index update** - Running record of all verification runs

## Usage

```
/verify                          # Full verification, auto-detect context
/verify [feature-name]           # Tag verification with feature name
/verify --quick                  # Analysis only (skip tests/build)
/verify --pre-commit             # Pre-commit check (analysis + tests)
```

**Examples:**
- `/verify user-auth` - Verify after completing user authentication feature
- `/verify` - Auto-detect from git branch or recent work
- `/verify --pre-commit` - Before committing changes

## Process

### Step 1: Determine Context

If feature name not provided:
1. Check current git branch for feature name
2. Check recent file changes for module context
3. Ask user if unclear

### Step 2: Detect Tech Stack

Read `project.yaml` for tech stack and run appropriate commands:

#### JavaScript/TypeScript Projects
```bash
# Static Analysis
npm run lint || npx eslint .

# Type checking (if TypeScript)
npm run typecheck || npx tsc --noEmit

# Tests
npm test

# Build
npm run build
```

#### Python Projects
```bash
# Static Analysis
ruff check . || flake8 .

# Type checking
mypy . || pyright .

# Tests
pytest

# Build verification
python -m py_compile $(find . -name "*.py")
```

#### Flutter/Dart Projects
```bash
# Static Analysis
flutter analyze --fatal-infos --fatal-warnings

# Formatting
dart format --set-exit-if-changed .

# Tests
flutter test

# Build
flutter build web
```

### Step 3: Capture Results

For each step, capture:
- Exit code (0 = pass, non-zero = fail)
- Stdout/stderr output
- Duration
- Timestamp

### Step 4: Generate Reports

#### Verification Report (`planning/verification-logs/YYYY-MM-DD_HHMM_[feature].md`)

```markdown
# Verification Report

**Feature**: [Feature Name]
**Date**: YYYY-MM-DD HH:MM
**Mode**: Full | Quick | Pre-commit
**Triggered By**: Manual | Pre-commit | Section Complete

## Summary

| Check | Status | Duration | Notes |
|-------|--------|----------|-------|
| Analysis | PASS/FAIL | 2.3s | 0 issues |
| Format | PASS/FAIL | 0.8s | ... |
| Tests | PASS/FAIL | 12.4s | ... |
| Build | PASS/FAIL | 45.2s | ... |

**Overall**: PASSED / FAILED

## Files in Scope

[List of files changed since last verification or in feature]

## Raw Output

See: `raw/YYYY-MM-DD_HHMM_[feature].log`

---
*Generated by /verify command*
```

#### Index Update (`planning/verification-logs/index.md`)

Append entry to running index:

```markdown
| Date | Feature | Mode | Result | Report |
|------|---------|------|--------|--------|
| 2026-01-01 14:30 | user-auth | Full | PASS | [Report](2026-01-01_1430_user-auth.md) |
```

### Step 5: Report to User

Display summary with pass/fail status for each check.

If any step fails, show the issues found and suggest fixes.

## Directory Structure

```
planning/verification-logs/
├── index.md                              # Running index of all verifications
├── 2026-01-01_1430_user-auth.md          # Report
├── 2026-01-02_0915_api-routes.md         # Report
└── raw/
    ├── 2026-01-01_1430_user-auth.log
    └── 2026-01-02_0915_api-routes.log
```

## Notes

- Verification does NOT auto-fix issues
- Failed verification still logs evidence (shows issues were detected)
- Each run is independent (no state between runs)
- Adapts to project tech stack automatically
